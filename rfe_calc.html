<!DOCTYPE HTML>
<!--
RFE_Calc is free software: you can redistribute it and/or modify it
under the terms of the GNU Lesser General Public License as  published
by the Free Software Foundation, either version 3 of the License, or (at
your option) any later version.

RFE_Calc is distributed in the hope that it will be useful, but WITHOUT
ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public
License for more details.

You should have received a copy of the GNU Lesser General Public License
along with RFE_Calc.  If not, see <http://www.gnu.org/licenses/>.

Copyright Â© 2009-2010, Vernon Mauery (N7OH)
-->
<html><head>
  <meta charset="UTF-8">
  <meta name="keywords" content="Amateur Radio RF Safety Calculator, RF Safety, RF Calculator, RF Safety Calculator, frequency, bands, licence, radio frequency, RF, MPE">
  <meta name="description" content="Calculate RF exposures for various transmitters, antennas and other settings">
  <title>N7OH RFE Calculator</title>
  <style>
div.value {
	display: inline;
}
td.value {
	text-align: center;
}
div.transmitter, div.antenna, div.connection {
	border: 2px solid gray;
	margin: 1em;
	padding: 0em 1em .25em 1em;
}
td.compliant {
	color: green;
}
td.noncompliant {
	color: red;
}
table {
	table-layout: fixed;
}
table th {
	text-align: left;
}
table td {
	padding: 0em .5em 0em .5em;
}
table.results {
	border: 1px solid;
	font-size: 80%;
}
table.results td, table.results th {
	border: 1px solid gray;
}
table.results td {
	padding: .1em .5em 0em .5em;
}
label::after {
	content: ": ";
}
a.link {
	cursor: pointer;
}
.action-box {
	display: none;
}
div.action-box {
	float: right;
}
div.popup-bg {
	width: 100%;
	height: 100%;
	position: fixed;
	left: 0;
	top: 0;
	background-color: rgba(128,128,128,.5);
	z-index: 100;
}
div.popup {
	position: fixed;
	left: 35%;
	top: 30%;
	width: 30%;
	padding: .5em 2em 2em 2em;
	border: 1px solid black;
	background: rgba(128,128,128,1);
	z-index: 1000;
}
div.help {
	display: none;
	border: 2px solid gray;
	margin: 1em;
	padding: 0.5em;
}
.help > h2 {
	margin-top: .1em;
	clear: none;
}
.help-hide {
	float: right;
}
a.help {
	float: right;
}
  </style>
  <link type="text/css" href="css/ui.all.css" rel="stylesheet" />
  <script type="text/javascript" src="js/jquery.js"></script>
  <script type="text/javascript" src="js/ui.core.js"></script>
  <script type="text/javascript" src="js/ui.tabs.js"></script>
  <script type="text/javascript" src="js/modernizr.js"></script>
  <script type="text/javascript" src="js/json2.js"></script>
  <script type="text/javascript">
<!--//
(function($) {$(function() {

const cm_per_foot = 30.48;

function array_size(arr) {
	var ret = 0;
	for (var k in arr) {
		ret++;
	}
	return ret;
}
function array_keys(arr) {
	var ret = [];
	for (k in arr) {
		ret.push(k);
	}
	return ret;
}
function array_zip(k, v) {
	var ret = {};
	for (kk in k) {
		ret[k[kk]] = v[kk];
	}
	return ret;
}
// expects an array or associative array and uses
// key/value pairs for options, index for arrays
function select_options(list, selected) {
	var opts = "";
	for (var k in list) {
		if (k == selected) {
			select = ' selected="selected"';
		} else {
			select = '';
		}
		opts += '<option value="'+k+'"'+select+'>'+list[k]+'</option>';
	}
	return opts;
}

function TransmitterBand(xmtr, band, bandinfo) {
	/* initializer */
	this.init = function(xmtr, band, bandinfo) {
		this.id = TransmitterBand.common_id++;
		this.xmtr = xmtr;
		if ( band != null && bandinfo != null) {
			this.band = band;
			this.power = bandinfo[0];
			this.mod = bandinfo[1];
			this.ce = bandinfo[2];
			this.ue = bandinfo[3];
		} else {
			this.band = Bands[0];
			this.power = 100;
			this.mod = modulation_duty_factor[0];
			this.ce = 50;
			this.ue = 50;
		}
		return true;
	};

	this.fini = function() {
		return [this.band, [this.power, this.mod, this.ce, this.ue]];
	};

	/* member functions */
	this.save = function() {
		var band = $('#edit-tband-'+this.id+'-band').attr('value') || this.band;
		var power = $('#edit-tband-'+this.id+'-power').attr('value') || this.power;
		var mod = $('#edit-tband-'+this.id+'-mod').attr('value') || this.mod;
		var ce = $('#edit-tband-'+this.id+'-ce').attr('value') || this.ce;
		var ue = $('#edit-tband-'+this.id+'-ue').attr('value') || this.ue;
		console.log('saving '+this.band+' tband, power: '+power+', modulation: '+mod+', cont exp: '+ce+', uncont exp: '+ue);
		// remove the old copy of whatever band this used to be
		// in the case of band renaming, this gets rid of the old band
		// while the assignment below saves us in the new (same?) band
		if (this.band in this.xmtr.bands) {
			delete this.xmtr.bands[this.band];
		}
		this.band = band;
		this.power = power;
		this.mod = mod;
		this.ce = ce;
		this.ue = ue;
		this.xmtr.bands[this.band] = this;
		save_transmitters();
		refresh();
	};

	this.ask_delete = function() {
		return confirm('Delete '+this.band+' band?');
	};

	this.editor = function() {
		var ret = '';
		if (this.band == null) {
			ret += '<h3>Add "'+this.xmtr.name+'" band</h3>';
		} else {
			ret += '<h3>Edit "'+this.xmtr.name+'" '+this.band+' band</h3>';
		}
		// band is a select, power is input, modulation is select, ce is input, ue is input
		var band_keys = array_keys(bands_filter(this.xmtr.bands, this.band));
		band_keys = array_zip(band_keys, band_keys);
		var mod_keys = array_keys(modulation_duty_factor);
		mod_keys = array_zip(mod_keys, mod_keys);
		ret += '<div class="edit-item"><label for="edit-tband-'+this.id+'-band">Band</label><select id="edit-tband-'+this.id+'-band">'+select_options(band_keys, this.band)+'</select/></div>';
		ret += '<div class="edit-item"><label for="edit-tband-'+this.id+'-power">Power (W)</label><input type="textbox" id="edit-tband-'+this.id+'-power" value="'+this.power+'"/></div>';
		ret += '<div class="edit-item"><label for="edit-tband-'+this.id+'-mod">Modulation</label><select id="edit-tband-'+this.id+'-mod">'+select_options(mod_keys, this.mod)+'</select></div>';
		ret += '<div class="edit-item"><label for="edit-tband-'+this.id+'-ce">Controlled exposure (%)</label><input type="textbox" id="edit-tband-'+this.id+'-ce" value="'+this.ce+'"/></div>';
		ret += '<div class="edit-item"><label for="edit-tband-'+this.id+'-ue">Uncontrolled exposure (%)</label><input type="textbox" id="edit-tband-'+this.id+'-ue" value="'+this.ue+'"/></div>';
		ret += '<div class="edit-item"><input type="submit" name="cancel" value="Cancel"/> ';
		ret += '<input type="submit" name="save" value="Save"/></div>';
		return ret;
	};
	return this.init(xmtr, band, bandinfo);
}
TransmitterBand.common_id = 0;

function Transmitter(init_data) {
	/* intializer */
	this.init = function(init_data) {
		if (init_data == null || init_data.length == 0) {
			this.name = '';
			bands = [];
		} else {
			this.name = init_data[0];
			bands = init_data[1];
		}
		this.id = Transmitter.common_id++;
		this.bands = {};
		for (band in bands) {
			var b = new TransmitterBand(this, band, bands[band]);
			this.bands[band] = b;
		}
		return true;
	};

	this.fini = function() {
		var bands = {};
		for (band in this.bands) {
			var v = this.bands[band].fini();
			bands[v[0]] = v[1];
		}
		return [this.name, bands];
	};

	/* member functions */
	this.ask_delete = function() {
		return confirm('Delete transmitter "'+this.name+'"?');
	};

	this.save = function() {
		var name = $('#edit-xmtr-'+this.id+'-name').attr('value');
		if (name != this.name) {
			this.name = name;
			console.log('saving '+this.name);
			transmitters[this.id] = this;
			save_connections();
			save_transmitters();
			refresh();
		}
	};

	this.editor = function() {
		var ret = '';
		if (this.name == "") {
			ret += '<h3>Add a transmitter</h3>';
		} else {
			ret += '<h3>Edit "'+this.name+'" transmitter</h3>';
		}
		ret += '<div class="edit-item"><label for="edit-xmtr-'+this.id+'-name">Name</label><input type="textbox" id="edit-xmtr-'+this.id+'-name" name="name" value="'+this.name+'"/></div>';
		ret += '<div class="edit-item"><input type="submit" name="cancel" value="Cancel"/> ';
		ret += '<input type="submit" name="save" value="Save"/></div>';
		return ret;
	};

	this.render = function() {
		var out = '<div class="transmitter action-popup"><div class="action-box"><a class="link add-a" id="add-a-tband-'+this.id+'">Add a band</a> | <a class="link edit-a" id="edit-a-xmtr-'+this.id+'">Edit</a> | <a class="link del-a" id="del-a-xmtr-'+this.id+'">Delete</a></div><h4>'+this.name+'</h4>\n<table width="100%">';
		out += '<tr><th width="15%">Band</th><th width="15%">Power (W)</th><th width="30%">Modulation</th><th>Controlled<br/>exposure (%)</th><th>Uncontrolled<br/>exposure (%)</th><th></th></tr>\n';
		for (var band in Bands) {
			if (!(band in this.bands)) continue;
			out += '<tr><td>'+band+'</td><td>'+this.bands[band].power+'</td><td>'+this.bands[band].mod+' ('+modulation_duty_factor[this.bands[band].mod]+'%)</td><td>'+this.bands[band].ce+'</td><td>'+this.bands[band].ue+'</td><td class="action-box"><a class="link edit-a" id="edit-a-tband-'+this.id+'-'+band+'">Edit</a> | <a class="link del-a" id="del-a-tband-'+this.id+'-'+band+'">Delete</a></td></td></tr>\n';
		}
		out += '</table></div>';
		return out;
	};

	return this.init(init_data);
}
Transmitter.common_id = 0;

function transmitter_by_name(name) {
	for (var t in transmitters) {
		if (transmitters[t].name == name)
			return transmitters[t];
	}
	return null;
}

function AntennaBand(ant, band, gain) {
	/* initializer */
	this.init = function(ant, band, gain) {
		this.id = AntennaBand.common_id++;
		this.antenna = ant;
		this.band = band;
		this.gain = gain || 2.15;
		return true;
	};

	this.fini = function() {
		return [this.band, this.gain];
	};

	/* member functions */
	this.save = function() {
		var band = $('#edit-aband-'+this.id+'-band').attr('value');
		var gain = parseFloat($('#edit-aband-'+this.id+'-gain').attr('value'));
		console.log('saving '+band+' aband, gain: '+gain);
		// remove the old copy of whatever band this used to be
		// in the case of band renaming, this gets rid of the old band
		// while the assignment below saves us in the new (same?) band
		if (this.band in this.antenna.bands) {
			delete this.antenna.bands[this.band];
		}
		this.band = band;
		this.gain = gain;
		this.antenna.bands[this.band] = this;
		save_antennas();
		refresh();
	};

	this.ask_delete = function() {
		return confirm('Delete '+this.band+' band?');
	};

	this.editor = function() {
		var ret = '';
		if (this.band == null) {
			ret += '<h3>Add "'+this.antenna.name+'" band</h3>';
		} else {
			ret += '<h3>Edit "'+this.antenna.name+'" '+this.band+' band</h3>';
		}
		// band is a select, power is input, modulation is select, ce is input, ue is input
		var band_keys = array_keys(bands_filter(this.antenna.bands, this.band));
		band_keys = array_zip(band_keys, band_keys);
		ret += '<div class="edit-item"><label for="edit-aband-'+this.id+'-band">Band</label><select id="edit-aband-'+this.id+'-band">'+select_options(band_keys, this.band)+'</select/></div>';
		ret += '<div class="edit-item"><label for="edit-aband-'+this.id+'-gain">Gain (dBi)</label><input type="textbox" id="edit-aband-'+this.id+'-gain" value="'+this.gain+'"/></div>';
		ret += '<div class="edit-item"><input type="submit" name="cancel" value="Cancel"/> ';
		ret += '<input type="submit" name="save" value="Save"/></div>';
		return ret;
	};
	return this.init(ant, band, gain);
}
AntennaBand.common_id = 0;

// ant_data is [bands, cdx, udx, ground]
function Antenna(name, ant_data) {
	this.init = function(name, ant_data) {
		this.id = Antenna.common_id++;
		this.bands = {};
		if (name == null) {
			this.name = '';
			this.cdx = 0;
			this.udx = 0;
			this.ground = true;
		} else {
			this.name = name;
			this.bands = {};
			for (b in ant_data[0]) {
				this.bands[b] = new AntennaBand(this, b, ant_data[0][b]);
			}
			this.cdx = ant_data[1];
			this.udx = ant_data[2];
			this.ground = ant_data[3];
		}
		return true;
	};

	this.fini = function() {
		var bands = {};
		for (band in this.bands) {
			var v = this.bands[band].fini();
			bands[v[0]] = v[1];
		}
		return [this.name, [bands, this.cdx, this.udx, this.ground]];
	};

	this.ask_delete = function() {
		return confirm('Delete antenna "'+this.name+'"?');
	};

	this.save = function() {
		var name = $('#edit-antenna-'+this.id+'-name').attr('value');
		var cdx = $('#edit-antenna-'+this.id+'-cdx').attr('value');
		var udx = $('#edit-antenna-'+this.id+'-udx').attr('value');
		var ground = $('#edit-antenna-'+this.id+'-ground').attr('value');
		ground = (ground == 'false')?false:true;
		console.log('saving "'+this.name+'" antenna, cdx: '+cdx+', udx: '+udx+', ground: '+ground);
		this.name = name;
		this.cdx = cdx;
		this.udx = udx;
		this.ground = ground;
		antennas[this.id] = this;
		save_connections();
		save_antennas();
		refresh();
	};

	this.editor = function() {
		ret = '';
		if (this.name == "") {
			ret += '<h3>Add an antenna</h3>';
		} else {
			ret += '<h3>Edit "'+this.name+'" antenna</h3>';
		}
		var ground_keys = {'true':'true', 'false':'false'};
		ret += '<div class="edit-item"><label for="edit-antenna-'+this.id+'-name">Name</label><input type="textbox" id="edit-antenna-'+this.id+'-name" name="name" value="'+this.name+'"/></div>';
		ret += '<div class="edit-item"><label for="edit-antenna-'+this.id+'-cdx">Controlled exposure (ft)</label><input type="textbox" id="edit-antenna-'+this.id+'-cdx" value="'+this.cdx+'"/></div>';
		ret += '<div class="edit-item"><label for="edit-antenna-'+this.id+'-udx">Uncontrolled exposure (ft)</label><input type="textbox" id="edit-antenna-'+this.id+'-udx" value="'+this.udx+'"/></div>';
		ret += '<div class="edit-item"><label for="edit-antenna-'+this.id+'-ground">Ground reflections</label><select id="edit-antenna-'+this.id+'-ground">'+select_options(ground_keys, String(this.ground))+'</select></div>';
		ret += '<div class="edit-item"><input type="submit" name="cancel" value="Cancel"/> ';
		ret += '<input type="submit" name="save" value="Save"/></div>';
		return ret;
	};

	this.render = function() {
		var out = '<div class="antenna action-popup"><div class="action-box"><a class="link add-a" id="add-a-aband-'+this.id+'">Add a band</a> | <a class="link edit-a" id="edit-a-antenna-'+this.id+'">Edit</a> | <a class="link del-a" id="del-a-antenna-'+this.id+'">Delete</a></div><h4>'+this.name+'</h4>\nDistances: Controlled exposure@'+this.cdx+'ft, Uncontrolled exposure@'+this.udx+'ft; Ground:'+this.ground+'\n<table width="100%">';
		out += '<tr><th width="15%">Band</th><th width="15%">Gain (dBi)</th><th></th></tr>\n';
		for (var band in Bands) {
			if (!(band in this.bands)) continue;
			out += '<tr><td>'+band+'</td><td>'+this.bands[band].gain+'</td><td class="action-box"><a class="link edit-a" id="edit-a-aband-'+this.id+'-'+band+'">Edit</a> | <a class="link del-a" id="del-a-aband-'+this.id+'-'+band+'">Delete</a></td></td></tr>\n';
		}
		out += '</table></div>';
		return out;
	};

	return this.init(name, ant_data);
}
Antenna.common_id = 0;

function antenna_by_name(name) {
	for (var a in antennas) {
		if (antennas[a].name == name)
			return antennas[a];
	}
	return null;
}

// conn_data is [transmitter, antenna, tuner_loss, wire, length, other_loss]
function Connection(conn_data) {
	this.init = function(conn_data) {
		if (conn_data == null) {
			this.transmitter = null;
			this.antenna = null;
			this.tuner_loss = this.length = this.other_loss = 0;
			this.wire = '';
			this.name = '';
		} else {
			this.transmitter = transmitter_by_name(conn_data[0]);
			this.antenna = antenna_by_name(conn_data[1]);
			this.tuner_loss = conn_data[2];
			this.wire = conn_data[3];
			this.length = conn_data[4];
			this.other_loss = conn_data[5];
			this.name = conn_data[0] + ' <-> ' + conn_data[1];
		}
		this.id = Connection.common_id++;
		return true;
	};

	this.fini = function() {
		return [this.transmitter.name, this.antenna.name,
				this.tuner_loss, this.wire, this.length, this.other_loss];
	};

	this.ask_delete = function() {
		return confirm('Delete '+this.name+' connection?');
	};

	this.save = function() {
		var xmtr = transmitters[parseInt($('#edit-conn-'+this.id+'-xmtr').attr('value'))];
		var ant = antennas[parseInt($('#edit-conn-'+this.id+'-ant').attr('value'))];
		var tloss = parseFloat($('#edit-conn-'+this.id+'-tloss').attr('value'));
		var wire = $('#edit-conn-'+this.id+'-wire').attr('value');
		var wlen = parseFloat($('#edit-conn-'+this.id+'-wlen').attr('value'));
		var other = parseFloat($('#edit-conn-'+this.id+'-other').attr('value'));
		var name = xmtr.name + ' <-> ' + ant.name;
		console.log('saving "'+name+'": tloss: '+tloss+', wire: '+wire+', length: '+wlen+', other: '+other);
		tt = this.transmitter;
		tid = this.transmitter?this.transmitter.id:0;
		aid = this.antenna?this.antenna.id:0;

		this.transmitter = xmtr;
		this.antenna = ant;
		this.tuner_loss = tloss;
		this.wire = wire;
		this.length = wlen;
		this.other_loss = other;

		if (tt != null) {
			for (i in connections) {
				if (connections[i].transmitter.id == tid &&
					connections[i].antenna.id == aid) {

					connections[i] = this;
					break;
				}
			}
		} else {
			connections.push(this);
		}
		save_connections();
		refresh();
	};

	this.editor = function() {
		var ret = '';
		if (this.transmitter == null) {
			ret += '<h3>Add a connection</h3>';
		} else {
			ret += '<h3>Edit "'+this.name+'" connection</h3>';
		}
		var tid = this.transmitter?this.transmitter.id:null;
		var aid = this.antenna?this.antenna.id:null;
		var wire_keys = array_keys(wires);
		wire_keys = array_zip(wire_keys, wire_keys);
		ret += '<div class="edit-item"><label for="edit-conn-'+this.id+'-xmtr">Transmitter</label><select id="edit-conn-'+this.id+'-xmtr">'+select_options(this.xmtr_list(), tid)+'</select/></div>';
		ret += '<div class="edit-item"><label for="edit-conn-'+this.id+'-ant">Antenna</label><select id="edit-conn-'+this.id+'-ant">'+select_options(this.ant_list(), aid)+'</select/></div>';
		ret += '<div class="edit-item"><label for="edit-conn-'+this.id+'-tloss">Tuner losses (dB)</label><input type="textbox" id="edit-conn-'+this.id+'-tloss" value="'+this.tuner_loss+'"/></div>';
		ret += '<div class="edit-item"><label for="edit-conn-'+this.id+'-wire">Wire type</label><select id="edit-conn-'+this.id+'-wire">'+select_options(wire_keys, this.wire)+'</select></div>';
		ret += '<div class="edit-item"><label for="edit-conn-'+this.id+'-wlen">Wire length (ft)</label><input type="textbox" id="edit-conn-'+this.id+'-wlen" value="'+this.length+'"/></div>';
		ret += '<div class="edit-item"><label for="edit-conn-'+this.id+'-other">Other losses (dB)</label><input type="textbox" id="edit-conn-'+this.id+'-other" value="'+this.other_loss+'"/></div>';
		ret += '<div class="edit-item"><input type="submit" name="cancel" value="Cancel"/> ';
		ret += '<input type="submit" name="save" value="Save"/></div>';
		return ret;
	};

	this.render = function() {
		var out = '<div class="connection action-popup"><div class="action-box"><a class="link edit-a" id="edit-a-conn-'+this.id+'">Edit</a> | <a class="link del-a" id="del-a-conn-'+this.id+'">Delete</a></div><h4>\''+this.transmitter.name+'\' to \''+this.antenna.name+'\' via '+ this.length+' ft of \''+this.wire+'\'</h4>\n<ul>';
		out += '<li>Transmitter: '+this.transmitter.name+'</li>\n';
		out += '<li>Antenna: '+this.antenna.name+'</li>\n';
		out += '<li>Tuner losses: '+this.tuner_loss+'</li>\n';
		out += '<li>Wire type: '+this.wire+'</li>\n';
		out += '<li>Wire length: '+this.length+'</li>\n';
		out += '<li>Other losses: '+this.other_loss+'</li>\n';
		out += '</ul></div>';
		return out;
	};

	this.results = function() {
		var tm = this.transmitter;
		var ant = this.antenna;
		ret = '<h3>\''+tm.name+'\' to \''+ant.name+'\' via '+ this.length+' ft of \''+this.wire+'\'</h3><div>Controlled distance: '+ant.cdx+' ft., Uncontrolled distance: '+ant.udx+' ft</div>';
		ret += '<table class="results"><tr><th rowspan="2">Band</th><th rowspan="2">Power (W)</th><th rowspan="2">Tuner Losses (dB)</th><th rowspan="2">Line Losses (dB)</th><th rowspan="2">Other Losses (dB)</th><th rowspan="2">Antenna Gain (dBi)</th><th rowspan="2">Power at Antenna (W)</th><th colspan="4">Controlled Exposure</th><th colspan="4">Uncontrolled Exposure</th></tr>\n';
		ret += '<tr><th>MPE (mW/cm<sup>2</sup>)</th><th>RF Exposure (mW/cm<sup>2</sup>)</th><th>Minimum Distance (ft)</th><th>Distance OK</th><th>MPE (mW/cm<sup>2</sup>)</th><th>RF Exposure (mW/cm<sup>2</sup>)</th><th>Minimum Distance (ft)</th><th>Distance OK</th></tr>\n';
		for (var b in Bands) {
			if (!(b in tm.bands) || ant.bands[b] == null) continue;
			var band = tm.bands[b];
			var freq = Bands[b][1];
			var line_loss = (this.length/100.0)*wires[this.wire][b];
			if (wires[this.wire][b] == null) {
				console.error("Wire '"+this.wire+"' has no loss info at "+b);
				line_loss = 0;
			}
			var tloss = this.tuner_loss + this.other_loss + line_loss;
			tloss = Math.pow(10, -(tloss/10.0));
			var gain = Math.pow(10, ant.bands[b].gain/10.0);
			ret += '<tr>';
			// calculate rfe/mpe/mdx for transmitter power at band with connection losses
			ce = calc_exposure(true, band.power, modulation_duty_factor[band.mod]/100.0, band.ce/100.0, tloss, gain, freq, ant.cdx*cm_per_foot, ant.ground);
			ue = calc_exposure(false, band.power, modulation_duty_factor[band.mod]/100.0, band.ue/100.0, tloss, gain, freq, ant.udx*cm_per_foot, ant.ground);
			ret += '<td>'+b+'</td><td>'+band.power+'</td><td>'+this.tuner_loss+'</td>';
			ret += '<td>'+line_loss.toPrecision(4)+'</td><td>'+this.other_loss+'</td>';
			ret += '<td>'+ant.bands[b].gain.toPrecision(4)+'</td>';
			ret += '<td>'+(band.power*tloss*gain).toPrecision(4)+'</td>';
			// controlled exposure
			ret += '<td>'+ce.mpe.toPrecision(4)+'</td>';
			ret += '<td>'+ce.rfe.toPrecision(4)+'</td>';
			ret += '<td>'+(ce.mdx/cm_per_foot).toPrecision(4)+'</td>';
			ret += '<td class="'+(ce.rfe < ce.mpe ? '':'non')+'compliant">'+(ce.rfe < ce.mpe ? 'Yes':'No')+'</td>';
			// uncontrolled exposure
			ret += '<td>'+ue.mpe.toPrecision(4)+'</td>';
			ret += '<td>'+ue.rfe.toPrecision(4)+'</td>';
			ret += '<td>'+(ue.mdx/cm_per_foot).toPrecision(4)+'</td>';
			ret += '<td class="'+(ue.rfe < ue.mpe ? '':'non')+'compliant">'+(ue.rfe < ue.mpe ? 'Yes':'No')+'</td>';
			ret += '</tr>';
		}
		ret += '</table>';
		return ret;
	};

	this.xmtr_list = function() {
		var ret = {};
		for (var t in transmitters) {
			ret[transmitters[t].id] = transmitters[t].name;
		}
		return ret;
	};

	this.ant_list = function() {
		var ret = {};
		for (var a in antennas) {
			ret[antennas[a].id] = antennas[a].name;
		}
		return ret;
	};

	return this.init(conn_data);
}
Connection.common_id = 0;

function connection_idx_from_transmitter(name) {
	conns = [];
	for (var c in connections) {
		var t = connections[c].transmitter;
		console.log('compare "'+name+'" to "'+t.name+'"');
		if (t.name == name) {
			console.log('found connection: '+connections[c].name);
			conns.push(c);
		}
	}
	return conns;
}

function connection_idx_from_antenna(name) {
	conns = [];
	for (var c in connections) {
		var a = connections[c].antenna;
		console.log('compare "'+name+'" to "'+a.name+'"');
		if (a.name == name) {
			console.log('found connection: '+connections[c].name);
			conns.push(c);
		}
	}
	return conns;
}

function popup_box(type, id, html) {
	$('body').append('<div class="popup-bg" id="popup-bg-'+type+'-'+id+'"></div><div class="popup" id="popup-'+type+'-'+id+'">'+html+'</div>');
	$('#popup-bg-'+type+'-'+id).unbind('click').click(function(e) {
		$(this).remove();
		$('#popup-'+type+'-'+id).remove();
	});
}

function add_a_thing(ele, next) {
	var type;
	var id;
	var thing;
	var subid;
	if (next == null) {
		var m = $(ele).attr('id').split('-');
		type = m[2];
		id = parseInt(m[3]);
		thing = null;
		subid = 0;
	} else {
		console.log('add a thing next: '+next);
		type = next[0];
		id = next[1];
	}
	switch (type) {
		case "xmtr":
			thing = new Transmitter();
			next = [ 'tband', thing.id ];
			break;
		case "tband":
			thing = new TransmitterBand(transmitters[id]);
			subid = thing.id;
			break;
		case "antenna":
			thing = new Antenna();
			next = [ 'aband', thing.id ];
			break;
		case "aband":
			thing = new AntennaBand(antennas[id]);
			subid = thing.id;
			break;
		case "connection":
			thing = new Connection();
			break;
	}
	if (thing == null) return;
	var pid = id+'-'+subid;
	popup_box(type, pid, thing.editor());
	$('#popup-'+type+'-'+pid).find(':submit[name=save]').click(function() {
		thing.save();
		if (next != null) {
			add_a_thing(null, next);
		}
	});
	$('#popup-'+type+'-'+pid).find(':submit').click(function() {
		$('#popup-'+type+'-'+pid).remove();
		$('#popup-bg-'+type+'-'+pid).remove();
	});
}

function edit_a_thing(ele) {
	var m = $(ele).attr('id').split('-');
	var type = m[2];
	var id = parseInt(m[3]);
	var index = m[4];
	var thing = null;
	console.log('edit_a_thing: type = '+type+', id = '+id+', index = '+index);
	switch (type) {
		case "xmtr":
			thing = transmitters[id];
			break;
		case "tband":
			thing = transmitters[id].bands[index];
			break;
		case "antenna":
			thing = antennas[id];
			break;
		case "aband":
			thing = antennas[id].bands[index];
			break;
		case "conn":
			thing = connections[id];
			break;
	}
	if (thing == null) return;
	popup_box(type, id, thing.editor());
	$('#popup-'+type+'-'+id).find(':submit[name=save]').click(function() {
		thing.save();
	});
	$('#popup-'+type+'-'+id).find(':submit').click(function() {
		$('#popup-'+type+'-'+id).remove();
		$('#popup-bg-'+type+'-'+id).remove();
	});
}

function del_a_thing(ele) {
	var m = $(ele).attr('id').split('-');
	var type = m[2];
	var id = parseInt(m[3]);
	var index = m[4];
	var thing = null;
	console.log('del_a_thing: type = '+type+', id = '+id+', index = '+index);
	switch (type) {
		case "xmtr":
			if (transmitters[id].ask_delete()) {
				var name = transmitters[id].name;
				var conns = connection_idx_from_transmitter(name);
				for (var c in conns) {
					console.log('deleting conn '+connections[conns[c]].name);
					delete connections[conns[c]];
				}
				delete transmitters[id];
				save_transmitters();
				save_connections();
			}
			break;
		case "tband":
			if (transmitters[id].bands[index].ask_delete()) {
				delete transmitters[id].bands[index];
				save_transmitters();
			}
			break;
		case "antenna":
			if (antennas[id].ask_delete()) {
				var name = antennas[id].name;
				var conns = connection_idx_from_antenna(name);
				for (var c in conns) {
					console.log('deleting conn '+connections[conns[c]].name);
					delete connections[conns[c]];
				}
				delete antennas[id];
				save_antennas();
				save_connections();
			}
			break;
		case "aband":
			if (antennas[id].bands[index].ask_delete()) {
				delete antennas[id].bands[index];
				save_antennas();
			}
			break;
		case "conn":
			if (connections[id].ask_delete()) {
				for (var c in connections) {
					if (connections[c].id == id) {
						console.log('deleting conn '+connections[c].name);
						delete connections[c];
					}
				}
			}
			break;
	}
	refresh();
}

function post_render() {
	$(".link").filter(".add-a").unbind('click').click(function() {
			add_a_thing(this);
	});
	$(".link").filter(".del-a").unbind('click').click(function() {
			del_a_thing(this);
	});
	$(".link").filter(".edit-a").unbind('click').click(function() {
			edit_a_thing(this);
	});
	$(".link").filter("#reset-data").unbind('click').click(function() {
		console.log('resetting data');
		reset_data_store();
	});
}

var wires = {
	'RG-8X': {'160m':0.349, '80m':0.656, '60m':0.809, '40m':0.931, '30m':1.116, '20m':1.352, '17m':1.507, '15m':1.631, '12m':1.855, '10m':1.890, '6m':2.55, '2m':4.458,},
	'RG-213/U': {'160m':0.192, '80m':0.361, '60m':0.446, '40m':0.514, '30m':0.616, '20m':0.732, '17m':0.833, '15m':0.901, '12m':1.026, '10m':1.045, '6m':1.413, '2m':2.482, },
	'LL-400': {'160m':0.2, '80m':0.22, '60m':0.28, '40m':0.3, '30m':0.35, '20m':0.40, '17m':0.45, '15m':0.54, '12m':0.6, '10m':0.67, '6m':0.88, '2m':1.52, '220 MHz':1.86, '440 MHz':2.71, '900 MHz':3.9, },
	'LL-600': {'160m':0.1, '80m':0.12, '60m':0.14, '40m':0.16, '30m':0.2, '20m':0.22, '17m':0.25, '15m':0.29, '12m':0.35, '10m':0.43, '6m':0.55, '2m':0.98, '220 MHz':1.19, '440 MHz':1.71, '900 MHz':2.5, },
	'WM CQ 551': {'160m':0.02, '80m':0.04, '60m':0.06, '40m':0.08, '30m':0.08, '20m':0.10, '17m':0.12, '15m':0.12, '12m':0.13, '10m':0.14, '6m':0.15, '2m':0.35, },
};
var Bands = {
	'160m':[1800000,2000000],
	'80m':[3500000,4000000],
	'60m':[5330000,5405000],
	'40m':[7000000,7300000],
	'30m':[10100000,10150000],
	'20m':[14000000,14350000],
	'17m':[18068000,18168000],
	'15m':[21000000,21450000],
	'12m':[24890000,24990000],
	'10m':[28000000,29700000],
	'6m':[50000000,54000000],
	'2m':[144000000,148000000],
	'220 MHz':[222000000,225000000],
	'440 MHz':[420000000,450000000],
	'900 MHz':[902000000,928000000],
	'1.2 GHz':[1240000000,1300000000],
	'2.3 GHz':[2300000000,2310000000],
	'2.4 GHz':[2390000000,2450000000],
	'3.3 GHz':[3300000000,3500000000],
	'5.6 GHz':[5650000000,5925000000],
	'10 GHz':[10000000000,10500000000],
	'24 GHz':[24000000000,24250000000],
	'47 GHz':[47000000000,47200000000],
	'76 GHz':[76000000000,81000000000],
	'122 GHz':[122250000000,123000000000],
	'134 GHz':[134000000000,141000000000],
	'241 GHz':[241000000000,250000000000],
	'275 GHz':[275000000000,300000000000],
};
function bands_filter(bands, current_band) {
	var ret = {};
	for (band in Bands) {
		if (band == current_band || !(band in bands)) {
			ret[band] = Bands[band];
		}
	}
	return ret;
}


var modulation_duty_factor = {
	'CW': 40,
	'SSB voice low': 20,
	'SSB voice high': 40,
	'FM': 100,
	'SSB AFSK': 100,
	'SSB SSTV': 100,
	'AM 50%': 50,
	'AM 100%': 25,
	'AM 0%': 100,
	'ATV': 60,
};

var transmitters = {};
var antennas = {};
var connections = [];

function serialize_transmitters() {
	var xmtr_data = {}
	for (var k in transmitters) {
		var v = transmitters[k].fini();
		xmtr_data[v[0]] = v[1];
	}
	return xmtr_data;
}
function save_transmitters() {
	setvar('transmitters', serialize_transmitters());
}
function load_transmitters(xmtr_data) {
	var t = {}
	for (var k in xmtr_data) {
		var nt = new Transmitter([k, xmtr_data[k]]);
		t[nt.id] = nt;
	}
	return t;
}
function serialize_antennas() {
	var ant_data = {}
	for (var k in antennas) {
		var v = antennas[k].fini();
		ant_data[v[0]] = v[1];
	}
	return ant_data;
}
function save_antennas() {
	setvar('antennas', serialize_antennas());
}
function load_antennas(ant_data) {
	var a = {};
	for (var k in ant_data) {
		var na = new Antenna(k, ant_data[k]);
		a[na.id] = na;
	}
	return a;
}
function serialize_connections() {
	var conn_data = new Array();
	for (var k in connections) {
		conn_data.push(connections[k].fini());
	}
	return conn_data;
}
function save_connections() {
	setvar('connections', serialize_connections());
}
function load_connections(conn_data) {
	var c = [];
	for (var k in conn_data) {
		c[k] = new Connection(conn_data[k]);
	}
	return c;
}

function reset_data_store() {
	if ((array_size(transmitters) ||
		array_size(antennas) ||
		array_size(connections)) &&
		!confirm('This cannot be undone.\nReplace all transmitter/antenna/connection data?')) {
			return;
	}
	var ltransmitters = {
		// Transmitter(name, bands)
		//band info is [power, duty cycle, win_c, win_u]
		'IC-7000':{'160m':[100, 'CW', 50, 50], '80m':[100, 'CW', 50, 50], '60m':[50, 'SSB voice high', 50, 50], '40m':[100, 'SSB voice high', 50, 50], '30m':[100, 'SSB voice high', 50, 50], '20m':[100, 'SSB voice high', 50, 50], '17m':[100, 'SSB voice high', 50, 50], '15m':[100, 'SSB voice high', 50, 50], '12m':[100, 'SSB voice high', 50, 50], '10m':[100, 'SSB voice high', 50, 30], '6m':[100, 'FM', 50, 50], '2m':[50, 'FM', 50, 50], '440 MHz':[30, 'FM', 50, 50]},
		'Elecraft K3/100':{'160m':[100, 'CW', 50, 50], '80m':[100, 'CW', 50, 50], '60m':[50, 'SSB voice high', 50, 50], '40m':[100, 'SSB voice high', 50, 50], '30m':[100, 'SSB voice high', 50, 50], '20m':[100, 'SSB voice high', 50, 50], '17m':[100, 'SSB voice high', 50, 50], '15m':[100, 'SSB voice high', 50, 50], '12m':[100, 'SSB voice high', 50, 50], '10m':[100, 'SSB voice high', 50, 30]},
		'IC-92AD':{'2m':[5, 'FM', 50, 50], '440 MHz':[5, 'FM', 50, 50]},
	};
	var lantennas = {
		// Antenna(name, bands, cdx, udx, ground)
		'Center-fed Zepp':[{'80m':1.9, '60m':2.0, '40m':2.5, '30m':3.1, '20m':3.1, '17m':3.1, '15m':3.1, '12m':3.2, '10m':3.2,}, 18, 16, true],
		'6/2/440 collinear':[{'6m':3.07, '2m':8.3, '440 MHz':11.7}, 6, 15, true],
		'2/440 collinear':[{'2m':3.76, '440 MHz':4.32}, 1, 50, true],
		'2/440 dipole':[{'2m':2.2, '440 MHz':3.02}, 1, 50, true],
	};
	var lconnections = [
		// Connection(transmitter, antenna, tuner_loss, wire, length, other_loss)
		['Elecraft K3/100', 'Center-fed Zepp', 0.1, 'LL-400', 150, 0.2],
		['IC-7000', 'Center-fed Zepp', 0.1, 'RG-8X', 150, 0.2],
		['IC-7000', '6/2/440 collinear', 0.0, 'LL-400', 150, 0.2],
		['IC-92AD', '6/2/440 collinear', 0.0, 'LL-400', 150, 0.2],
		['IC-92AD', '2/440 collinear', 0.0, 'LL-400', 30.0, 0.0],
		['IC-92AD', '2/440 dipole', 0.0, 'LL-400', 30.0, 0.0],
		];
	setvar('antennas', lantennas);
	setvar('transmitters', ltransmitters);
	setvar('connections', lconnections);
	transmitters = load_transmitters(getvar('transmitters'));
	antennas = load_antennas(getvar('antennas'));
	connections = load_connections(getvar('connections'));
	refresh();
	window.location.reload(true);
}

function page_init() {
	$('#eximport-import').unbind('click').click(import_data);
	$('#eximport-export').unbind('click').click(export_data);
	$('#eximport-reset').unbind('click').click(reset_data);
	$('#eximport-sample').unbind('click').click(reset_data_store);
}

function log_err(msg, e) {
	console.error(msg + ': '+e.stack);
}

function refresh(mask_errors) {
	if (mask_errors == null) mask_errors = true;
	var error = null;
	try {
		show_transmitters();
	} catch (e) { log_err('transmitters failed to render: ', e); error = e; }; try {
		show_antennas();
	} catch (e) { log_err('antennas failed to render: ', e); error = e; }; try {
		show_connections();
	} catch (e) { log_err('connections failed to render: ', e); error = e; }; try {
		show_results();
	} catch (e) { log_err('results failed to render: ', e); error = e; }
	if (error != null && !mask_errors) throw error;
	do_interactive();
	post_render();
}
function show_transmitters() {
	console.log('show_transmitters');
	$('#transmitters > .dynamic').children().remove();
	for (var t in transmitters) {
		$('#transmitters > .dynamic').append(transmitters[t].render());
	}
}
function show_antennas() {
	console.log('show_antennas');
	$('#antennas > .dynamic').children().remove();
	for (var a in antennas) {
		$('#antennas > .dynamic').append(antennas[a].render());
	}
}
function show_connections() {
	console.log('show_connections');
	$('#connections > .dynamic').children().remove();
	for (var c in connections) {
		$('#connections > .dynamic').append(connections[c].render());
	}
}
function show_results() {
	console.log('show_results');
	$('#results > .dynamic').children().remove();
	for (var c in connections) {
		$('#results > .dynamic').append(connections[c].results());
	}
// | transmitter | power | band | tuner losses | line losses | other losses | rfe | mpe | mdx | ok
}
function reset_data() {
	if ((array_size(transmitters) ||
		array_size(antennas) ||
		array_size(connections)) &&
		!confirm('This cannot be undone.\nDelete all transmitter/antenna/connection data?')) {
			return;
	}
	delvar('antennas');
	delvar('connections');
	delvar('transmitters');
	delete transmitters;
	delete antennas;
	delete connections;
	window.location.reload(true);
}
function export_data() {
	var data = {
		'antennas': getvar('antennas', {}),
		'connections': getvar('connections', []),
		'transmitters': getvar('transmitters', {}),
	};
	$('#eximport-data').val(JSON.stringify(data));
}
function import_data() {
	if ((array_size(transmitters) ||
		array_size(antennas) ||
		array_size(connections)) &&
		!confirm('This cannot be undone.\nReplace all transmitter/antenna/connection data?')) {
			return;
	}
	try {
		var data = $('#eximport-data').val();
		if (data.length < 60) return;
		console.log('import:\n'+data);
		data = JSON.parse(data);
		transmitters = load_transmitters(data['transmitters']);
		antennas = load_antennas(data['antennas']);
		connections = load_connections(data['connections']);
		refresh(false);
		setvar('antennas', data['antennas']);
		setvar('connections', data['connections']);
		setvar('transmitters', data['transmitters']);
		window.location.reload(true);
	} catch (e) {
		log_err('failed to import: ', e);
		alert('Imported data was not in correct format');
		window.location.reload(true);
	}
}
function calc_mpe(frequency, controlled) {
	frequency /= 1000000;
	if (frequency < 1.34) {
		return 100.0;
	}  /**  Below 1.34 MHz  **/
	else if (frequency < 3.0) {
		if (controlled) return 100.0;
		return 180.0 / (Math.pow(frequency,2));
	}  /**  Below 3.0 MHz  **/
	else if (frequency < 30.0) {
		if (controlled) return 900.0 / Math.pow(frequency,2);
		return 180.0 / (Math.pow(frequency,2));
	}  /**  Below 30 MHz  **/
	else if (frequency < 300.0) {
		if (controlled) return 1.0;
		return 0.2;
	}  /**  Below 300 MHz  **/
	else if (frequency < 1500.0) {
		if (controlled) return frequency / 300.0
			return frequency / 1500.0;
	}  /**  Below 1500 MHz  **/
	else if (frequency < 100000.0) {
		if (controlled) return 5.0;
		return 1.0;
	}  /**  Below 100 GHz  **/
	else {  /**  Frequency too high  **/
		console.error("The FCC does not have exposure limits above 100 GHz.  Please try again.");
		return;
	}  /**  Frequency too high  **/
}
/* inputs:
  @controlled: this is controlled or uncontrolled (bool)
  @watts: max watts at transmitter
  @tdc: transmission duty cycle (~20% for voice, ~40% for CW)
  @winave: average window x/6 for controlled, x/30 for controlled
  @tloss: total losses from transmitter to antenna (fraction, not in dB)
  @gain: antenna gain (fraction, not in dB)
  @dx: distance from center of antenna in cm
  @ground: calculate ground reflections (bool)
  returns:
  @pd: power density
  @mpe: maximum permissible exposure
  @dxm: minimum distance to compliance in cm
*/
function calc_exposure(controlled, watts, tdc, winave, tloss, gain, freq, dx, ground) {
	//console.log('calc_exposure('+controlled+', '+watts+', '+tdc+', '+winave+', '+tloss+', '+gain+', '+freq+', '+dx+', '+ground);
	var power = tdc * tloss * watts * 1000 * winave * gain;
	var rfe, mpe, mdx;
	if ((power > 0) && (dx > 0)) {
		if (ground)
			gf = 0.64;
		else
			gf = 0.25;
		rfe = (gf * power) / (Math.PI * Math.pow(dx,2));
		mpe = calc_mpe(freq, controlled);
		mdx = Math.sqrt((gf * power)/(mpe * Math.PI));
	}
	//console.log("{rfe:"+rfe+", mpe:"+mpe+", mdx:"+mdx+"}");
	return {rfe:rfe, mpe:mpe, mdx:mdx};
}
function hide_elements(ele) {
	$(ele).children().filter('.action-box').hide();
}
function do_interactive() {
	$('.action-popup').hover(function() {
		$(this).find('.action-box').show();
	}, function() {
		$(this).find('.action-box').hide();
	});
	$('.link').filter('.help').unbind('click').click(function() {
		var m = $(this).attr('id').split('-');
		var type = m[1];
		$('#help-'+type).hide();
		$('#help-text-'+type).slideDown(250);
	});
	$('.link').filter('.help-hide').unbind('click').click(function() {
		var m = $(this).attr('id').split('-');
		var type = m[2];
		$('#help-text-'+type).slideUp(250, function() {
			$('#help-'+type).show();
		});
	});
}
function delvar(name) {
	window.localStorage.removeItem('rfe.'+name);
}
function setvar(name, value) {
	window.localStorage['rfe.'+name] = JSON.stringify(value);
}
function getvar(name, default_value) {
	var v = window.localStorage['rfe.'+name];
	if (v == null)
		return default_value;
	return JSON.parse(v);
}

 $("#tabs").tabs();
 if (!Modernizr.localstorage) {
  alert('Your browser does not have local storage\nThis means that you will not be able to save\nany of your changes.');
 }

 transmitters = load_transmitters(getvar('transmitters', []));
 antennas = load_antennas(getvar('antennas', []));
 connections = load_connections(getvar('connections', []));
 page_init();
 refresh();

}); })(jQuery);

-->
  </script>
</head><body bgcolor="#ffffff" text="#000000">

<div id="tabs">
    <ul>
        <li><a href="#transmitters"><span>Transmitters</span></a></li>
        <li><a href="#antennas"><span>Antennas</span></a></li>
        <li><a href="#connections"><span>Connections</span></a></li>
        <li><a href="#results"><span>Results</span></a></li>
		<li><a href="#eximport"><span>Import/Export</span></a></li>
		<li><a href="#about"><span>About</span></a></li>
    </ul>
    <div id="transmitters">
		<a class="link add-a" id="add-a-xmtr">Add a transmitter</a>
		<a class="link help" id="help-xmtr">Help</a>
		<div class="help" id="help-text-xmtr">
			<a class="link help-hide" id="help-hide-xmtr">Hide help</a>
			<h2>Transmitters</h2>
			<p>
			The Transmitters tab is where you should start.  In this tab, you
			add a transmitter for each one you want to run calculations for.
			You get to pick the name, but the names must be unique, so if you
			have three of one radio, give them a suffix or something.
			</p><p>
			After clicking on "Add a transmitter", you will be prompted to "Add
			a band" for that transmitter.  Just like your real radio, each
			transmitter here can have its own bands.  It will continue to
			prompt you to add new bands until you hit "Cancel".  If you decide
			at some later time to add more bands, you can manually click on the
			"Add a band" link inside the transmitter box.  Deleting or editing
			the bands and/or transmitters can be done with those links as well.
			</p><p>
			As you add the bands, you specify information on how you will be
			using that band for this calculator.  For example, if you typically
			use 50W on the 80m band while using CW, you should enter that data
			there.  This way, you can model your real-life usage of the radio.
			In addition, you should enter your usage windows for controlled and
			uncontrolled exposure.  Remember that the controlled exposure
			window is six minutes long and the uncontrolled window is 30
			minutes.  These two fields here are not in minutes, but rather in
			percentage.  So fill in the percentages appropriately.
			</p><p>
			If you are using an amplifier with your radio, you can just assume
			that the radio is putting out the amplifier's output for the sake
			of simplification.
			</p><p>
			You only get to fill out each band once per transmitter, so use the
			highest power configuration you plan on using.  Note that the
			various modulation modes and exposure percentages will also reduce
			the total RFE in the calculations.
			</p><p>
			After adding all your transmitters and transmitter bands, go on to
			the Antennas tab.
			</p>
		</div>
		<div class="dynamic">
		</div>
    </div>
    <div id="antennas">
		<a class="link add-a" id="add-a-antenna">Add an antenna</a>
		<a class="link help" id="help-antenna">Help</a>
		<div class="help" id="help-text-antenna">
			<a class="link help-hide" id="help-hide-antenna">Hide help</a>
			<h2>Antennas</h2>
			<p>
			The Antennas tab is where you enter information about your
			antennas.  This includes the controlled and uncontrolled distances
			for which we are making calculations.  Also, it gives you a chance
			to enter the gain for each band that the antenna will be used with.
			</p><p>
			Click on "Add an antenna" to start with and enter the basic
			information.  The "Ground reflections" entry is whether or not to
			use the formula to incorporate ground reflections in the RFE
			totals.  I use it, but you should refer to Bulletin 65 for what you
			think you should do.  The controlled and uncontrolled distances are
			basically how close you and your household can get to the antenna
			and how close anyone else can get to it.
			</p><p>
			After saving the antenna, you will be prompted to add bands until
			you hit the "Cancel" button.  This allows you to set the gain for
			each band.  This gain is used in the formulas for calculating RFE.
			It should be listed as dBi, not dBd.  If your antenna specs are in
			dBd, take the dBd number and add 2.15 to it.
			</p><p>
			If you need to, you can always go back and add, delete or edit the
			bands that you have created.  When you have entered all your
			antennas, move on to the Connections tab.
			</p>
		</div>
		<div class="dynamic">
		</div>
    </div>
    <div id="connections">
		<a class="link add-a" id="add-a-connection">Add a connection</a>
		<a class="link help" id="help-connection">Help</a>
		<div class="help" id="help-text-connection">
			<a class="link help-hide" id="help-hide-connection">Hide help</a>
			<h2>Connections</h2>
			<p>
			The Connections tab is where you define the connections that are
			between your transmitters and your antennas.  Each
			transmitter/antenna pair can only have one connection, but each
			transmitter can connect to multiple antennas and each antenna can
			be connected to multiple transmitters, with each connection having
			different characteristics.
			</p><p>
			Things that are included in the connection properties are wire
			type, wire length, tuner losses, and any other losses (lightning
			suppressors, line splitters, etc.)  This allows you to have a wide
			range of flexibility in accurately modeling your connection setup.
			All losses are specified in dB, so be sure to enter them that way.
			If you need to add multiple losses to put in the other losses
			field, you just add the dB values together.
			</p><p>
			Currently, I only have specs on a few wire types available, but if
			you want this application to have more, feel free to send the specs
			to me and I will add them.  Just make sure that they cover a wide
			range so they can be used on lots of bands.
			</p><p>
			Add a connection for every physical connection you plan on
			modeling.  You will see a section for each connection in the
			Results tab.
			</p>
		</div>
		<div class="dynamic">
		</div>
    </div>
    <div id="results">
		<a class="link help" id="help-results">Help</a>
		<div class="help" id="help-text-results">
			<a class="link help-hide" id="help-hide-results">Hide help</a>
			<h2>Results</h2>
			<p>
			The Results tab is where all the results of the calculations are
			shown for each of the radio/connection/antenna groups that you have
			specified.
			</p><p>
			Listed in convenient tables, you see the data you entered in the
			first few columns and then starting with "Power at Antenna", you
			see the ERP for each band.  Then, using that number, the
			calculations show the RFE at both the controlled and uncontrolled
			distances, the minimum allowable distance for each band and then
			whether or not the band is within the limitations set by the FCC.
			</p><p>
			For each connection shown in the Results tab, and for each band
			within those connections, you should make sure that both the
			controlled and uncontrolled exposures are within the limits.  There
			is a box that will say "yes" or "no" for each entry.  If any of the
			boxes say "no", then you need to look into your setup to see what
			you can do to reduce the RF exposure for that band.  Some options
			are to: </p><ol>
			<li>Use a lower output power</li>
			<li>Use a smaller operating window (i.e. transmit for less time in
			each six or 30 minutes segments)</li>
			<li>Use a modulation that is less power (FM is 100% modulation
			whereas CW is only about 40%)</li>
			<li>Use a lower-gain antenna or a more lossy network (it would be a
			better idea to just turn down the power)</li>
			</ol>
		</div>
		<div class="dynamic">
		</div>
    </div>
    <div id="eximport">
		<a class="link help" id="help-eximport">Help</a>
		<div class="help" id="help-text-eximport">
			<a class="link help-hide" id="help-hide-eximport">Hide help</a>
			<h2>Import/Export</h2>
			<p>
			In the Import/Export tab, you can save your information for another
			day or copy it to send to a friend.  All the data is already stored
			in your browser (only locally&mdash;the application transmits no
			data back to the server&mdash;all the calculations and data are
			done on the client).
			</p><p>
			To export, hit the Export button and the data will all show up in a
			weird looking format that can be copied and saved in a text file.
			Then you can send it to a friend or use it later.
			</p><p>
			To import, paste exported data into the text area and hit the
			Import button.  This will try to slurp up all the data and make
			sense of it.  If something goes wrong, it should gracefully die,
			without destroying what is already on your system.
			</p><p>
			To clear all the data off your system, press the "Clear all data"
			button.  This will remove all saved settings from this application
			from your browser, allowing you to start over with a clean slate.
			</p><p>
			To view some sample data, you can click on the "Reset to sample
			data" button.  This will remove all previous settings and replace
			them with some canned settings.
			</p>
		</div>
		<div class="edit-items">
		<input id="eximport-import" type="button" name="import" value="Import"/>
		<input id="eximport-export" type="button" name="export" value="Export"/>
		<input id="eximport-reset" type="button" name="reset" value="Reset all data"/>
		<input id="eximport-sample" type="button" name="reset" value="Reset to sample data"/>
		</div>
        <textarea id="eximport-data" rows="20" cols=80"></textarea>
    </div>
	<div id="about">
	<p>
	RFE Calculator - A tool to help hams figure out the mysteries of RF Exposure<br/>
    Copyright &copy; 2009-2010 Vernon Mauery (N7OH)<br/>
	</p><p>
	The idea originated from the <a
	href='http://hintlink.com/power_density.htm'>power density calculator
	written by W4/VP9KF</a>.<br/>
	I started writing my own javascript version only to find that it was<br/>
	really annoying to need to retype everything in each time I visited<br/>
	the page.  I wanted something that would store my data.  And I wanted<br/>
	to be able to share the application with other, but I didn't want to<br/>
	store <i>their</i> information.  I finally learned about local storage<br/>
	with HTML 5 and decided that I could use that for this application.<br/>
	</p><hr/><tt><p>
    This program is free software: you can redistribute it and/or modify<br/>
    it under the terms of the GNU General Public License as published by<br/>
    the Free Software Foundation, either version 3 of the License, or<br/>
    (at your option) any later version.<br/>
	</p><p>
    This program is distributed in the hope that it will be useful,<br/>
    but WITHOUT ANY WARRANTY; without even the implied warranty of<br/>
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the<br/>
    GNU General Public License for more details.<br/>
	</p><p>
    You should have <a href="LICENSE">received a copy</a> of the GNU General Public License<br/>
    along with this program.  If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.</p></tt>
	</div>
</div>

</body>
</html>

